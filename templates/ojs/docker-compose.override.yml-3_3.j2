# File: docker-compose.yml
#
# Site:    {{ site }}
# Tool:    {{ dojo.tool }}
# Version: {{ dojo.version }}
#

version: "3.8"

services:
  app:
    labels:
      # Enable traefik for this stack:
      - "traefik.enable=true"

      # HTTPS routers:
      - "traefik.http.routers.{{ dojo.id | lower }}-secure.rule=Host({{ proxy.domains }})"
      - "traefik.http.routers.{{ dojo.id | lower }}-secure.entrypoints=websecure"
      - "traefik.http.routers.{{ dojo.id | lower }}-secure.tls=true"
      - "traefik.http.routers.{{ dojo.id | lower }}-secure.tls.certresolver=leresolver"

      # Redirect Scheme HTTP -> HTTPS:
      - "traefik.http.middlewares.{{ dojo.id | lower }}-redirect.redirectscheme.scheme=https"
      - "traefik.http.middlewares.{{ dojo.id | lower }}-redirect.redirectscheme.permanent=true"

    networks:
      - proxy

networks:
  proxy:
    external: true